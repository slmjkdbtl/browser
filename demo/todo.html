<html>

<head>
	<title>todo</title>
</head>

<body>
	<script src="../ok.js"></script>
	<script>

const {
	h,
	css,
	render,
	signal,
	dbg,
} = ok

css({
	"#app": {
		"width": "240px",
		"> #inputbar": {
			"width": "100%",
			"display": "flex",
			"flex-direction": "row",
			"justify-content": "space-between",
		},
		"> #list": {
			"width": "100%",
			"> .item": {
				"display": "flex",
				"flex-direction": "row",
				"justify-content": "space-between",
				"width": "100%",
				"> .info": {
					"display": "flex",
					"flex-direction": "row",
					"> .title": {
						"cursor": "pointer",
						"user-select": "none",
						"&.crossed": {
							"text-decoration": "line-through",
						},
					},
				},
				"> .delete": {
					"display": "none",
				},
				":hover > .delete": {
					"display": "block",
				},
			},
		},
	},
})

const todos = signal((() => {
	if (localStorage["todo"]) {
		return JSON.parse(localStorage["todo"])
	} else {
		return []
	}
})())

function save() {
	localStorage["todo"] = JSON.stringify(todos.get())
}

const input = signal("")

function add() {
	if (!input.get()) {
		return
	}
	todos.set([
		...todos.get(),
		{
			title: input.get(),
			done: false,
		},
	])
	input.set("")
}

render(document.body, h("#app", {}, [
	h("button", {
		onclick: () => console.log(dbg.numSubs),
	}, "numsubs"),
	h("#inputbar", {}, [
		h("input", {
			placeholder: "enter your new task",
			value: input,
			onkeyup: (e) => e.key === "Enter" && add(),
			oninput: (e) => input.set(e.target.value)
		}),
		h("button", {
			onclick: add,
		}, "add"),
	]),
	h("#list", {}, todos.every((item, idx) => {
		const done = signal(item.done)
		return h(".item", {}, [
			h(".info", {}, [
				h("input", {
					type: "checkbox",
					checked: done,
					onchange: (e) => {
						done.set(e.target.checked)
						item.done = done.get()
						save()
					},
				}),
				h(".title", {
					onclick: () => {
						done.set((c) => !c)
						item.done = done.get()
						save()
					},
					classes: done.map((c) => [ c && "crossed" ]),
				}, item.title),
			]),
			h("button.delete", {
				onclick: () => {
					todos.set((t) => t.filter((_, idx2) => idx2 !== idx))
					save()
				},
			}, "delete"),
		])
	})),
]))

	</script>
</body>

</html>
